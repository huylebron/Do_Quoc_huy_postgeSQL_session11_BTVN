CREATE TABLE products (
    id            SERIAL PRIMARY KEY,
    name          TEXT NOT NULL,
    price         NUMERIC(12, 2) NOT NULL,
    last_modified TIMESTAMPTZ DEFAULT now()
);


CREATE OR REPLACE FUNCTION update_last_modified()
RETURNS trigger AS $$
BEGIN
    -- Mỗi khi UPDATE, gán lại thời điểm hiện tại cho cột last_modified
    NEW.last_modified := now();
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;


CREATE TRIGGER trg_update_last_modified
BEFORE UPDATE ON products
FOR EACH ROW
EXECUTE FUNCTION update_last_modified();


INSERT INTO products (name, price)
VALUES
    ('iPhone 15',          25000000),
    ('Samsung Galaxy S24', 22000000),
    ('MacBook Pro 14',     45000000),
    ('AirPods Pro 2',       6000000),
    ('iPad Air',           18000000);


UPDATE products
SET price = price * 1.10
WHERE id = 1;



SELECT id, name, price, last_modified
FROM products
WHERE id = 1;




